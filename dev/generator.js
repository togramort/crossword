let words=[],word;const gridSize=30;let crosswordAll,slots=gridSize*gridSize,gridDiv=document.getElementById("grid"),row=0,column=0;for(let r=0;r<slots;r++){let r=document.createElement("DIV");r.id=row+"_"+column,r.classList.add("slot"),r.style.border="1px solid #e9e9e9",r.style.backgroundColor="#e9e9e9",gridDiv.appendChild(r),++column>=gridSize&&(column=0,row++)}function getWords(){var e=(e=document.getElementById("answers").value).split("\n"),r=(r=document.getElementById("questions").value).split("\n");for(let r=0;r<e.length;++r)words.push(e[r].toLowerCase());crosswordAll=r.map((r,e)=>({id:e+1,word:words[e],clue:r.trim(),dir:"nn"})),words.sort(()=>Math.random()-.5),makeGrid(),wordPlacement()}const emptyCell="_";let grid=Array.from(Array(gridSize),()=>new Array(gridSize));function makeGrid(){for(let e=0;e<gridSize;e++)for(let r=0;r<gridSize;r++)grid[e][r]=emptyCell}const MULTI_VALUE_SEPARATOR="|";function placeWordH(r,e,o,l){for(var n=l;n<e.length+l;++n)r[o][n]=e[n-l];var d=crosswordAll.findIndex(r=>r.word==e);return isNaN(r[o][l-1])?r[o][l-1]=crosswordAll[d].id:r[o][l-1]+=MULTI_VALUE_SEPARATOR+crosswordAll[d].id,r}function placeWordV(r,e,o,l){for(var n=o;n<e.length+o;++n)r[n][l]=e[n-o];var d=crosswordAll.findIndex(r=>r.word==e);return isNaN(r[o-1][l])?r[o-1][l]=crosswordAll[d].id:r[o-1][l]+=MULTI_VALUE_SEPARATOR+crosswordAll[d].id,r}function canPlace(r,e,o,l,n){var d=!0,t=!0,i=!1,s=!1;o+1<r.length&&0<o-1&&"_"==r[o-1][l]&&"_"==r[o+1][l]&&0<o-n?(i=!0,o-=n):l+1<r.length&&0<l-1&&"_"==r[o][l-1]&&"_"==r[o][l+1]&&0<l-n&&(s=!0,l-=n),o+e.length>=r.length&&(t=!1),l+e.length>=r[0].length&&(d=!1);if(t&&i)for(var c=o;c<o+e.length+1;++c){if(("_"!=r[c][l]||"_"!=r[c][l+1]||"_"!=r[c][l-1]||"_"!=r[o-1][l])&&r[c][l]!=e[c-o]){t=!1;break}0}if(d&&s)for(c=l;c<l+e.length+1;++c){if(("_"!=r[o][c]||"_"!=r[o+1][c]||"_"!=r[o-1][c]||"_"!=r[o][l-1])&&r[o][c]!=e[c-l]){d=!1;break}0}return[e,o,l,t&&i?"v":d&&s?"h":"nn"]}function placeOnGrid(r,e,o,l,n){return"h"==n?e=placeWordH(e,r,o,l):"v"==n&&(e=placeWordV(e,r,o,l)),e}function wordPlacement(){var r=words.length,e=1,o=(n=words.pop(),placeWordH(grid,n,gridSize/2-5,gridSize/2-Math.floor(n.length/2)-3),crosswordAll.findIndex(r=>r.word==n));for(crosswordAll[o].dir="h";1<r&&0<words.length;){for(var l=[],n=words.pop(),d=0;d<n.length;d++)for(var t=0;t<grid.length;++t)for(var i=0;i<grid[t].length;++i)grid[t][i]==n[d]&&l.push(canPlace(grid,n,t,i,d));for(d=0;d<l.length;++d){var n=l[d][0],t=l[d][1],i=l[d][2],s=l[d][3];if("nn"!=s){grid=placeOnGrid(n,grid,t,i,s),++e;var c=crosswordAll.findIndex(r=>r.word==n);crosswordAll[c].dir=s;break}}}alert("использовано слов: "+e),displayCrosswordPuzzle(grid)}function displayCrosswordPuzzle(o){for(let e=0;e<gridSize;++e)for(let r=0;r<gridSize;++r){var l=document.getElementById(e+"_"+r);"_"!=o[e][r]&&isNaN(o[e][r])?(l.innerHTML=o[e][r],l.style.borderBottom="1px solid #9a8e9a",l.style.borderRight="1px solid #9a8e9a",l.style.backgroundColor="rgb(102, 178, 255)",l.style.fontSize="22px"):isNaN(o[e][r])?(l.innerHTML="",l.style.border="1px solid #1c1b1b",l.style.backgroundColor="#e9e9e9"):(l.innerHTML=o[e][r],l.style.border="1px solid #1c1b1b",l.style.backgroundColor="#e9e9e9",l.style.fontSize="15px")}printClues()}function printClues(){var r=document.getElementById("questionsV"),e=document.getElementById("questionsH");r.innerHTML="",e.innerHTML="",r.innerHTML="<h3>vertical</h3>",e.innerHTML="<h3>horizontal</h3>";for(var o=0;o<crosswordAll.length;++o){var l=crosswordAll[o].id+". "+crosswordAll[o].clue;"h"==crosswordAll[o].dir?e.innerHTML+=l+"<br>\n":"v"==crosswordAll[o].dir&&(r.innerHTML+=l+"<br>\n")}}function writeDataToJson(){var o=[];console.log("gr in wr",grid);for(let e=0;e<gridSize;e++)for(let r=0;r<gridSize;r++)o.push({x:e,y:r,symbol:grid[e][r]});console.log("data in wr",o);var r=JSON.stringify(o),r=(fetch("/uploadcross",{method:"POST",headers:{"content-type":"application/json"},body:r}).then(r=>r.text()).then(alert("successfully sent")).catch(r=>{console.error(r)}),crosswordAll.map(({id:r,clue:e,dir:o})=>({id:r,clue:e,dir:o})));fetch("/uploadclues",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r)}).then(r=>r.text()).catch(r=>{console.error(r)})}